import requests
from bs4 import BeautifulSoup
import json
from datetime import datetime
import time

def scrape_matches():
    url = 'https://yalla-shoot.io/'  # Ø£Ùˆ Ø£ÙŠ Ù…ÙˆÙ‚Ø¹ Ø¬Ø¯ÙˆÙ„ Ù…Ø¨Ø§Ø±ÙŠØ§Øª
    headers = {
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64)'
    }

    try:
        response = requests.get(url, headers=headers, timeout=10)
        response.raise_for_status()
    except Exception as e:
        print(f"ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„: {e}")
        return []

    soup = BeautifulSoup(response.text, 'html.parser')

    matches = []
    
    for match_card in soup.select('.match-card'):
        try:
            teams = match_card.select('.team-name')
            time_match = match_card.select_one('.match-time').text.strip()
            stream_link = match_card.find('a', href=True)['href']

            match_data = {
                'team1': teams[0].text.strip(),
                'team2': teams[1].text.strip(),
                'time': time_match,
                'league': 'Ù…Ø¨Ø§Ø±Ø§Ø© ÙˆØ¯ÙŠØ©' if 'ÙˆØ¯ÙŠØ©' in match_card.text else 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',  # ØªÙ‚Ø¯Ø± ØªØ·ÙˆØ±Ù‡Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹
                'stream_link': stream_link
            }
            matches.append(match_data)
        except Exception as e:
            print(f"Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù‚Ø±Ø§Ø¡Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©: {e}")

    return matches

def save_to_json(matches):
    now = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
    data = {
        'status': 'success',
        'last_update': now,
        'total_matches': len(matches),
        'matches': matches
    }
    with open('matches.json', 'w', encoding='utf-8') as f:
        json.dump(data, f, ensure_ascii=False, indent=4)

def main_loop(interval_minutes=5):
    while True:
        print("ğŸ”„ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ«...")
        matches = scrape_matches()
        if matches:
            save_to_json(matches)
            print(f"âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« matches.json Ø¨Ù†Ø¬Ø§Ø­ ({len(matches)} Ù…Ø¨Ø§Ø±ÙŠØ§Øª)")
        else:
            print("âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¨Ø§Ø±ÙŠØ§Øª.")
        
        print(f"â³ Ø§Ù„Ø¥Ù†ØªØ¸Ø§Ø± {interval_minutes} Ø¯Ù‚Ø§Ø¦Ù‚ Ù‚Ø¨Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ§Ù„ÙŠ...")
        time.sleep(interval_minutes * 60)

if __name__ == "__main__":
    main_loop()
